import{b as i,A as N,ag as Ye,ah as Fe,ai as Je,aj as Qe,_ as De,P as W,r as X,y as D,x as se,a as g,o as f,E as H,w as u,c as v,T as j,e as p,S as A,h as P,m as x,a1 as Ge,B as Xe,a3 as Ze,d as s,H as T,ak as U,R as V,Q as y,al as Ke,am as et,a4 as q}from"./index-7fe48c48.js";import{H as tt}from"./HeaderComponent-b710ac36.js";import{D as Ne,R as nt,F as ot}from"./ReloadOutlined-5bd8abd1.js";var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"};const at=lt;function $e(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){st(o,c,n[c])})}return o}function st(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var ie=function(t,n){var r=$e({},t,n.attrs);return i(N,$e({},r,{icon:at}),null)};ie.displayName="CodeOutlined";ie.inheritAttrs=!1;const it=ie;var rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M690 405h-46.9c-10.2 0-19.9 4.9-25.9 13.2L512 563.6 406.8 418.2c-6-8.3-15.6-13.2-25.9-13.2H334c-6.5 0-10.3 7.4-6.5 12.7l178 246c3.2 4.4 9.7 4.4 12.9 0l178-246c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"down-circle",theme:"outlined"};const dt=rt;function je(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){ct(o,c,n[c])})}return o}function ct(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var re=function(t,n){var r=je({},t,n.attrs);return i(N,je({},r,{icon:dt}),null)};re.displayName="DownCircleOutlined";re.inheritAttrs=!1;const ut=re;function Ae(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){pt(o,c,n[c])})}return o}function pt(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var de=function(t,n){var r=Ae({},t,n.attrs);return i(N,Ae({},r,{icon:Ye}),null)};de.displayName="EditOutlined";de.inheritAttrs=!1;const ft=de;function Me(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){_t(o,c,n[c])})}return o}function _t(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var ce=function(t,n){var r=Me({},t,n.attrs);return i(N,Me({},r,{icon:Fe}),null)};ce.displayName="InfoCircleOutlined";ce.inheritAttrs=!1;const mt=ce;function Ie(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){vt(o,c,n[c])})}return o}function vt(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var ue=function(t,n){var r=Ie({},t,n.attrs);return i(N,Ie({},r,{icon:Je}),null)};ue.displayName="LoadingOutlined";ue.inheritAttrs=!1;const gt=ue;function Ee(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){bt(o,c,n[c])})}return o}function bt(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var pe=function(t,n){var r=Ee({},t,n.attrs);return i(N,Ee({},r,{icon:Qe}),null)};pe.displayName="PlusOutlined";pe.inheritAttrs=!1;const yt=pe;var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"};const Ot=ht;function Te(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),r.forEach(function(c){kt(o,c,n[c])})}return o}function kt(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}var fe=function(t,n){var r=Te({},t,n.attrs);return i(N,Te({},r,{icon:Ot}),null)};fe.displayName="SettingOutlined";fe.inheritAttrs=!1;const ae=fe,wt="/assets/how-to-add-models-e7ab1776.png";const Ct={__name:"TableConfigComponent",props:{config:{type:Object,default:()=>({})}},emits:["update:config"],setup(o,{emit:t}){const n=o,r=t,c=W([]);n.config&&Object.entries(n.config).forEach(([h,k])=>{c.push({key:h,value:k})});const I=X(!1),M=X(!1),d=X({key:"",value:""}),m=()=>{M.value=!0,I.value=!0},O=()=>{if(d.value.key===""||d.value.value===""){x.warning("键或值不能为空");return}if(c.some(h=>h.key===d.value.key)){x.warning("键已存在");return}c.push({key:d.value.key,value:d.value.value}),I.value=!1,d.value={key:"",value:""},M.value=!1},R=h=>{c.splice(h,1)},Z=h=>{},E=D(()=>c.reduce((h,k)=>(h[k.key]=k.value,h),{}));return se(E,h=>{r("update:config",h)},{deep:!0}),se(I,h=>{h||(M.value=!1)}),(h,k)=>{const L=g("a-input"),w=g("a-col"),Y=g("a-button"),K=g("a-row"),F=g("a-form"),J=g("a-form-item"),Q=g("a-modal"),ee=g("a-card");return f(),H(ee,{class:"config-card",style:{"max-width":"960px"}},{default:u(()=>[i(F,{layout:"vertical"},{default:u(()=>[(f(!0),v(A,null,j(c,(S,B)=>(f(),v("div",{key:B,class:"config-item"},[i(K,{gutter:[16,8],align:"middle"},{default:u(()=>[i(w,{span:8},{default:u(()=>[i(L,{value:S.key,"onUpdate:value":z=>S.key=z,class:"key-input",placeholder:"模型名称",readonly:""},null,8,["value","onUpdate:value"])]),_:2},1024),i(w,{span:14},{default:u(()=>[i(L,{value:S.value,"onUpdate:value":z=>S.value=z,class:"value-input",placeholder:"模型本地路径",onChange:z=>Z(B)},null,8,["value","onUpdate:value","onChange"])]),_:2},1024),i(w,{span:2,class:"delete-btn-col"},{default:u(()=>[i(Y,{class:"delete-btn",danger:"",type:"link",onClick:z=>R(B)},{default:u(()=>[i(p(Ne))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),i(Y,{disabled:M.value,block:"",class:"add-btn",onClick:m},{default:u(()=>[i(p(yt)),k[3]||(k[3]=P(" 添加路径映射 "))]),_:1},8,["disabled"])]),_:1}),i(Q,{open:I.value,"onUpdate:open":k[2]||(k[2]=S=>I.value=S),class:"config-modal",title:"添加路径映射",onOk:O},{default:u(()=>[i(F,{layout:"vertical"},{default:u(()=>[i(J,{label:"模型名称（与Huggingface名称一致，比如 BAAI/bge-large-zh-v1.5",required:""},{default:u(()=>[i(L,{value:d.value.key,"onUpdate:value":k[0]||(k[0]=S=>d.value.key=S),class:"modal-input",placeholder:"请输入模型名称"},null,8,["value"])]),_:1}),i(J,{label:"模型本地路径（绝对路径，比如 /hdd/models/BAAI/bge-large-zh-v1.5）",required:""},{default:u(()=>[i(L,{value:d.value.value,"onUpdate:value":k[1]||(k[1]=S=>d.value.value=S),class:"modal-input",placeholder:"请输入模型本地路径"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}},Pt=De(Ct,[["__scopeId","data-v-a0324e96"]]),St="/assets/openai-3528e80f.png",xt="/assets/qianfan-e282a7e8.png",$t="/assets/dashscope-c2bfc769.png",ze="/assets/together.ai-3773ca5e.png",jt="/assets/deepseek-1ef07c84.png",At="/assets/zhipuai-6650eba1.png",Mt="/assets/siliconflow-1cf49dc4.png",It="/assets/ark-ed5d8178.png",Et="/assets/lingyiwanwu-f904765e.png",Tt="/assets/openrouterai-27440b6e.png",zt="/assets/default-f5dcec2c.png",G={openai:St,qianfan:xt,dashscope:$t,together:ze,deepseek:jt,zhipu:At,siliconflow:Mt,ark:It,"together.ai":ze,lingyiwanwu:Et,openrouter:Tt,default:zt};const Dt={class:""},Nt={class:"setting-container layout-container"},Lt={key:0,class:"sider"},Bt={key:1,class:"setting"},Ut={class:"section"},Vt={class:"card"},qt={class:"label"},Wt={class:"card"},Ht={class:"label"},Rt={class:"section"},Yt={class:"card card-select"},Ft={class:"label"},Jt={class:"card card-select"},Qt={class:"label"},Gt={class:"card"},Xt={class:"label"},Zt={class:"card card-select"},Kt={class:"label"},en={key:2,class:"setting"},tn={class:"model-provider-card"},nn={class:"card-body"},on=["onClick"],ln={class:"card-models__header"},an=["title"],sn={class:"action"},rn={class:"api_base"},dn=["onClick"],cn=["src"],un={class:"model-title-container"},pn={key:0,class:"card-body"},fn=["onClick"],_n={class:"model_name"},mn={class:"card-header"},vn={class:"model-icon"},gn=["src"],bn={class:"model-title-container"},yn={style:{"font-weight":"400"}},hn=["href"],On={class:"missing-keys"},kn={key:3,class:"setting"},wn={key:0,class:"modal-loading-container"},Cn={key:1,class:"modal-config-content"},Pn={class:"modal-config-header"},Sn={class:"modal-models-section"},xn={class:"modal-checkbox-list"},$n={key:0,class:"modal-no-models"},jn={key:1},An={__name:"SettingView",setup(o){const t=Ge(),n=D(()=>t.config._config_items),r=D(()=>{var a;return(a=t.config)==null?void 0:a.model_names}),c=D(()=>{var a;return(a=t.config)==null?void 0:a.model_provider_status}),I=D(()=>{var a;return(a=t.config)==null?void 0:a.model_provider}),M=X(!1),d=W({modelTitle:"添加自定义模型",visible:!1,custom_id:"",name:"",api_key:"",api_base:"",edit_type:"add"}),m=W({visible:!1,provider:"",providerName:"",models:[],allModels:[],selectedModels:[],loading:!1}),O=W({loading:!1,section:"base",windowWidth:(window==null?void 0:window.innerWidth)||0}),R=D(()=>Object.keys(c.value||{}).filter(a=>{var e;return(e=c.value)==null?void 0:e[a]})),Z=D(()=>Object.keys(c.value||{}).filter(a=>{var e;return!((e=c.value)!=null&&e[a])})),E=W({});se(R,a=>{a.forEach(e=>{E[e]===void 0&&(E[e]=!0)})},{immediate:!0});const h=a=>{E[a]=!E[a]},k=a=>{let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",_="";for(let $=0;$<a;$++)_+=e.charAt(Math.floor(Math.random()*e.length));return _},L=a=>{w("model_local_paths",a)},w=(a,e)=>{if(a=="enable_knowledge_graph"&&e&&!t.config.enable_knowledge_base){x.error("启动知识图谱必须请先启用知识库功能");return}if(a=="enable_knowledge_base"&&!e&&t.config.enable_knowledge_graph){x.error("关闭知识库功能必须请先关闭知识图谱功能");return}(a=="enable_reranker"||a=="enable_knowledge_graph"||a=="enable_knowledge_base"||a=="enable_web_search"||a=="embed_model"||a=="reranker"||a=="model_local_paths")&&(M.value||(M.value=!0,Ke.info({message:"需要重新加载模型",description:"请点击右下角按钮重新加载模型",placement:"topLeft",duration:0,btn:U(et,{type:"primary",onClick:B},"立即重新加载")}))),t.setConfigValue(a,e)},Y=async()=>{if(!d.name||!d.api_base){x.error("请填写完整的模型名称和API Base信息。");return}let a=t.config.custom_models||[];const e={custom_id:d.custom_id||`${d.name}-${k(4)}`,name:d.name,api_key:d.api_key,api_base:d.api_base};if(d.edit_type==="add"){if(a.find(_=>_.custom_id===d.custom_id)){x.error("模型ID已存在");return}a.push(e)}else a=a.map(_=>_.custom_id===d.custom_id?e:_);d.visible=!1,await t.setConfigValue("custom_models",a),x.success(d.edit_type==="add"?"模型添加成功":"模型修改成功")},K=a=>{const e=t.config.custom_models.filter(_=>_.custom_id!==a);t.setConfigValue("custom_models",e)},F=a=>{d.modelTitle="编辑自定义模型",d.custom_id=a.custom_id,d.visible=!0,d.edit_type="edit",d.name=a.name,d.api_key=a.api_key,d.api_base=a.api_base},J=()=>{d.modelTitle="添加自定义模型",d.edit_type="add",d.visible=!0,Q()},Q=()=>{d.custom_id="",d.name="",d.api_key="",d.api_base=""},ee=()=>{Q(),d.visible=!1},S=()=>{O.windowWidth=(window==null?void 0:window.innerWidth)||0};Xe(()=>{S(),window.addEventListener("resize",S)}),Ze(()=>{window.removeEventListener("resize",S)});const B=()=>{console.log("Restarting..."),x.loading({content:"重新加载模型中",key:"restart",duration:0}),fetch("/api/restart",{method:"POST"}).then(()=>{console.log("Restarted"),x.success({content:"重新加载完成!",key:"restart",duration:2}),setTimeout(()=>{window.location.reload()},200)})},z=a=>{m.loading=!0,fetch(`/api/chat/models?model_provider=${a}`).then(e=>e.json()).then(e=>{console.log(`${a} 模型列表:`,e);let _=[];e.data&&Array.isArray(e.data)?_=e.data:e.models&&Array.isArray(e.models)?_=e.models.map($=>typeof $=="string"?{id:$}:$):e.models&&e.models.data&&Array.isArray(e.models.data)&&(_=e.models.data),console.log("处理后的模型列表:",_),m.allModels=_,m.loading=!1}).catch(e=>{console.error(`获取${a}模型列表失败:`,e),x.error({content:`获取${r.value[a].name}模型列表失败`,duration:2}),m.loading=!1})},_e=a=>{var _;m.provider=a,m.providerName=r.value[a].name,m.allModels=[],m.visible=!0,m.loading=!0;const e=((_=r.value[a])==null?void 0:_.models)||[];m.selectedModels=[...e],z(a)},Le=async()=>{if(!c.value[m.provider]){x.error("请在 src/.env 中配置对应的 APIKEY，并重新启动服务");return}x.loading({content:"保存配置中...",key:"save-config",duration:0});try{const a=await fetch(`/api/chat/models/update?model_provider=${m.provider}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m.selectedModels)});if(!a.ok)throw new Error("保存模型配置失败");const e=await a.json();console.log("更新后的模型列表:",e.models),x.success({content:"模型配置已保存!",key:"save-config",duration:2}),m.visible=!1,t.refreshConfig()}catch(a){console.error("保存配置失败:",a),x.error({content:"保存配置失败: "+a.message,key:"save-config",duration:2})}},Be=()=>{m.visible=!1};return(a,e)=>{var be,ye,he,Oe,ke,we,Ce,Pe,Se,xe;const _=g("a-button"),$=g("a-switch"),te=g("a-select-option"),ne=g("a-select"),Ue=g("a-popconfirm"),me=g("a-input"),oe=g("a-form-item"),Ve=g("a-input-password"),qe=g("a-form"),ve=g("a-modal"),We=g("a-spin"),He=g("a-checkbox"),Re=g("a-checkbox-group"),ge=g("a-alert");return f(),v("div",Dt,[i(tt,{title:"设置",class:"setting-header"},{description:u(()=>e[16]||(e[16]=[s("p",null,[P("配置文件也可以在 "),s("code",null,"saves/config/base.yaml"),P(" 中修改")],-1)])),actions:u(()=>[i(_,{type:M.value?"primary":"default",onClick:B,icon:U(p(nt))},{default:u(()=>[P(y(M.value?"需要刷新":"重新加载"),1)]),_:1},8,["type","icon"])]),_:1}),s("div",Nt,[O.windowWidth>520?(f(),v("div",Lt,[i(_,{type:"text",class:T({activesec:O.section==="base"}),onClick:e[0]||(e[0]=l=>O.section="base"),icon:U(p(ae))},{default:u(()=>e[17]||(e[17]=[P(" 基本设置 ")])),_:1},8,["class","icon"]),i(_,{type:"text",class:T({activesec:O.section==="model"}),onClick:e[1]||(e[1]=l=>O.section="model"),icon:U(p(it))},{default:u(()=>e[18]||(e[18]=[P(" 模型配置 ")])),_:1},8,["class","icon"]),i(_,{type:"text",class:T({activesec:O.section==="path"}),onClick:e[2]||(e[2]=l=>O.section="path"),icon:U(p(ot))},{default:u(()=>e[19]||(e[19]=[P(" 路径配置 ")])),_:1},8,["class","icon"])])):V("",!0),O.windowWidth<=520||O.section==="base"?(f(),v("div",Bt,[e[20]||(e[20]=s("h3",null,"功能配置",-1)),s("div",Ut,[s("div",Vt,[s("span",qt,y((be=n.value)==null?void 0:be.enable_knowledge_base.des),1),i($,{checked:p(t).config.enable_knowledge_base,onChange:e[3]||(e[3]=l=>w("enable_knowledge_base",!p(t).config.enable_knowledge_base))},null,8,["checked"])]),s("div",Wt,[s("span",Ht,y((ye=n.value)==null?void 0:ye.enable_knowledge_graph.des),1),i($,{checked:p(t).config.enable_knowledge_graph,onChange:e[4]||(e[4]=l=>w("enable_knowledge_graph",!p(t).config.enable_knowledge_graph))},null,8,["checked"])])]),e[21]||(e[21]=s("h3",null,"检索配置",-1)),s("div",Rt,[s("div",Yt,[s("span",Ft,y((he=n.value)==null?void 0:he.embed_model.des),1),i(ne,{style:{width:"300px"},value:(Oe=p(t).config)==null?void 0:Oe.embed_model,onChange:e[5]||(e[5]=l=>w("embed_model",l))},{default:u(()=>{var l;return[(f(!0),v(A,null,j((l=n.value)==null?void 0:l.embed_model.choices,(C,b)=>(f(),H(te,{key:b,value:C},{default:u(()=>[P(y(C),1)]),_:2},1032,["value"]))),128))]}),_:1},8,["value"])]),s("div",Jt,[s("span",Qt,y((ke=n.value)==null?void 0:ke.reranker.des),1),i(ne,{style:{width:"300px"},value:(we=p(t).config)==null?void 0:we.reranker,onChange:e[6]||(e[6]=l=>w("reranker",l)),disabled:!p(t).config.enable_reranker},{default:u(()=>{var l;return[(f(!0),v(A,null,j((l=n.value)==null?void 0:l.reranker.choices,(C,b)=>(f(),H(te,{key:b,value:C},{default:u(()=>[P(y(C),1)]),_:2},1032,["value"]))),128))]}),_:1},8,["value","disabled"])]),s("div",Gt,[s("span",Xt,y((Ce=n.value)==null?void 0:Ce.enable_reranker.des),1),i($,{checked:p(t).config.enable_reranker,onChange:e[7]||(e[7]=l=>w("enable_reranker",!p(t).config.enable_reranker))},null,8,["checked"])]),s("div",Zt,[s("span",Kt,y((Pe=n.value)==null?void 0:Pe.use_rewrite_query.des),1),i(ne,{style:{width:"200px"},value:(Se=p(t).config)==null?void 0:Se.use_rewrite_query,onChange:e[8]||(e[8]=l=>w("use_rewrite_query",l))},{default:u(()=>{var l;return[(f(!0),v(A,null,j((l=n.value)==null?void 0:l.use_rewrite_query.choices,(C,b)=>(f(),H(te,{key:b,value:C},{default:u(()=>[P(y(C),1)]),_:2},1032,["value"]))),128))]}),_:1},8,["value"])])])])):V("",!0),O.windowWidth<=520||O.section==="model"?(f(),v("div",en,[e[29]||(e[29]=s("h3",null,"模型配置",-1)),e[30]||(e[30]=s("p",null,[P("请在 "),s("code",null,"src/.env"),P(" 文件中配置对应的 APIKEY，并重新启动服务")],-1)),s("div",tn,[e[27]||(e[27]=s("div",{class:"card-header"},[s("h3",null,"自定义模型")],-1)),s("div",nn,[(f(!0),v(A,null,j(p(t).config.custom_models,(l,C)=>(f(),v("div",{class:T({model_selected:I.value=="custom"&&p(t).config.model_name==l.custom_id,"card-models":!0,"custom-model":!0}),key:l.custom_id,onClick:b=>{w("model_provider","custom"),w("model_name",l.custom_id)}},[s("div",ln,[s("div",{class:"name",title:l.name},y(l.name),9,an),s("div",sn,[i(Ue,{title:"确认删除该模型?",onConfirm:b=>K(l.custom_id),okText:"确认删除",cancelText:"取消","ok-type":"danger",disabled:p(t).config.model_name==l.name},{default:u(()=>[i(_,{type:"text",disabled:p(t).config.model_name==l.name,onClick:e[9]||(e[9]=q(()=>{},["stop"]))},{default:u(()=>[i(p(Ne))]),_:2},1032,["disabled"])]),_:2},1032,["onConfirm","disabled"]),i(_,{type:"text",onClick:q(b=>F(l),["stop"])},{default:u(()=>[i(p(ft))]),_:2},1032,["onClick"])])]),s("div",rn,y(l.api_base),1)],10,on))),128)),s("div",{class:"card-models custom-model",onClick:J},[e[25]||(e[25]=s("div",{class:"card-models__header"},[s("div",{class:"name"}," + 添加模型")],-1)),e[26]||(e[26]=s("div",{class:"api_base"},"添加兼容 OpenAI 的模型",-1)),i(ve,{class:"custom-model-modal",open:d.visible,"onUpdate:open":e[13]||(e[13]=l=>d.visible=l),title:d.modelTitle,onOk:Y,onCancel:ee,okText:"确认",cancelText:"取消",okButtonProps:{disabled:!d.name||!d.api_base},"ok-type":"primary"},{default:u(()=>[e[24]||(e[24]=s("p",null,"添加的模型是兼容 OpenAI 的模型，比如 vllm，Ollama。",-1)),i(qe,{model:d,layout:"vertical"},{default:u(()=>[i(oe,{label:"模型名称",name:"name",rules:[{required:!0,message:"请输入模型名称"}]},{default:u(()=>[e[22]||(e[22]=s("p",{class:"form-item-description"},"调用的模型的名称",-1)),i(me,{value:d.name,"onUpdate:value":e[10]||(e[10]=l=>d.name=l),disabled:d.edit_type=="edit"},null,8,["value","disabled"])]),_:1}),i(oe,{label:"API Base",name:"api_base",rules:[{required:!0,message:"请输入API Base"}]},{default:u(()=>[e[23]||(e[23]=s("p",{class:"form-item-description"},[P("比如 "),s("code",null,"http://localhost:11434/v1")],-1)),i(me,{value:d.api_base,"onUpdate:value":e[11]||(e[11]=l=>d.api_base=l)},null,8,["value"])]),_:1}),i(oe,{label:"API KEY",name:"api_key"},{default:u(()=>[i(Ve,{value:d.api_key,"onUpdate:value":e[12]||(e[12]=l=>d.api_key=l),visibilityToggle:!1,autocomplete:"new-password"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","okButtonProps"])])])]),(f(!0),v(A,null,j(R.value,(l,C)=>(f(),v("div",{class:"model-provider-card",key:C},[s("div",{class:"card-header",onClick:b=>h(l)},[s("div",{class:T({"model-icon":!0,available:c.value[l]})},[s("img",{src:p(G)[l]||p(G).default,alt:"模型图标"},null,8,cn)],2),s("div",un,[s("h3",null,y(r.value[l].name),1)]),i(_,{type:"text",class:"expand-button",onClick:q(b=>_e(l),["stop"]),title:"配置模型提供商"},{default:u(()=>[i(p(ae))]),_:2},1032,["onClick"]),i(_,{type:"text",class:"expand-button",onClick:q(b=>h(l),["stop"])},{default:u(()=>[s("span",{class:T(["icon-wrapper",{rotated:E[l]}])},[i(p(ut))],2)]),_:2},1032,["onClick"])],8,dn),s("div",{class:T(["card-body-wrapper",{expanded:E[l]}])},[c.value[l]?(f(),v("div",pn,[(f(!0),v(A,null,j(r.value[l].models,(b,le)=>(f(),v("div",{class:T({model_selected:I.value==l&&p(t).config.model_name==b,"card-models":!0}),key:le,onClick:Mn=>{w("model_provider",l),w("model_name",b)}},[s("div",_n,y(b),1)],10,fn))),128))])):V("",!0)],2)]))),128)),(f(!0),v(A,null,j(Z.value,(l,C)=>(f(),v("div",{class:"model-provider-card",key:C},[s("div",mn,[s("div",vn,[s("img",{src:p(G)[l]||p(G).default,alt:"模型图标"},null,8,gn)]),s("div",bn,[s("h3",yn,y(r.value[l].name),1),s("a",{href:r.value[l].url,target:"_blank",class:"model-url"},[i(p(mt))],8,hn)]),i(_,{type:"text",class:"config-button",onClick:q(b=>_e(l),["stop"]),title:"配置模型提供商"},{default:u(()=>[i(p(ae))]),_:2},1032,["onClick"]),s("div",On,[e[28]||(e[28]=P(" 需配置")),(f(!0),v(A,null,j(r.value[l].env,(b,le)=>(f(),v("span",{key:le},y(b),1))),128))])])]))),128))])):V("",!0),O.windowWidth<=520||O.section==="path"?(f(),v("div",kn,[e[31]||(e[31]=s("h3",null,"本地模型配置",-1)),e[32]||(e[32]=s("p",null,"如果是 Docker 启动，务必确保在 docker-compose.dev.yaml 中添加了 volumes 映射。",-1)),i(Pt,{config:(xe=p(t).config)==null?void 0:xe.model_local_paths,"onUpdate:config":L},null,8,["config"])])):V("",!0)]),i(ve,{class:"provider-config-modal",open:m.visible,"onUpdate:open":e[15]||(e[15]=l=>m.visible=l),title:`配置${m.providerName}模型`,onOk:Le,onCancel:Be,okText:"保存配置",cancelText:"取消","ok-type":"primary",width:800,bodyStyle:{padding:"16px 24px"}},{default:u(()=>[m.loading?(f(),v("div",wn,[i(We,{indicator:U(p(gt),{style:{fontSize:"32px",color:"var(--main-color)"}})},null,8,["indicator"]),e[33]||(e[33]=s("div",{class:"loading-text"},"正在获取模型列表...",-1))])):(f(),v("div",Cn,[s("div",Pn,[s("h3",null,"选择 "+y(m.providerName)+" 的模型",1),e[34]||(e[34]=s("p",{class:"description"},"勾选您希望在系统中启用的模型，请注意，列表中可能包含非对话模型，请仔细甄别。",-1))]),s("div",Sn,[s("div",xn,[i(Re,{value:m.selectedModels,"onUpdate:value":e[14]||(e[14]=l=>m.selectedModels=l)},{default:u(()=>[(f(!0),v(A,null,j(m.allModels,(l,C)=>(f(),v("div",{key:C,class:"modal-checkbox-item"},[i(He,{value:l.id},{default:u(()=>[P(y(l.id),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"])]),m.allModels.length===0?(f(),v("div",$n,[c.value[m.provider]?(f(),v("div",jn,[i(ge,{type:"warning",message:"该提供商暂未适配获取模型列表的方法，如果需要添加模型，请在 src/static/models.private.yml 中添加。"}),e[35]||(e[35]=s("img",{src:wt,alt:"添加模型指引",style:{width:"100%",height:"100%"}},null,-1))])):(f(),H(ge,{key:0,type:"warning",message:"请在 src/.env 中配置对应的 APIKEY，并重新启动服务"}))])):V("",!0)])]))]),_:1},8,["open","title"])])}}},zn=De(An,[["__scopeId","data-v-3c08ff4c"]]);export{zn as default};
