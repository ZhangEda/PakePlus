import{H as z}from"./HeaderComponent-b710ac36.js";import{b as a,A as M,ac as B,_ as E,P as q,r as I,B as Q,a as m,o as U,c as W,w as o,d as c,ad as G,h as p,Q as O,e as v,E as J,R as X,m as D,ae as Z,af as K}from"./index-7fe48c48.js";function V(i){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},d=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),d.forEach(function(u){ee(i,u,n[u])})}return i}function ee(i,e,n){return e in i?Object.defineProperty(i,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[e]=n,i}var x=function(e,n){var d=V({},e,n.attrs);return a(M,V({},d,{icon:B}),null)};x.displayName="DownloadOutlined";x.inheritAttrs=!1;const te=x;var ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const ne=ae;function H(i){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},d=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),d.forEach(function(u){oe(i,u,n[u])})}return i}function oe(i,e,n){return e in i?Object.defineProperty(i,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[e]=n,i}var L=function(e,n){var d=H({},e,n.attrs);return a(M,H({},d,{icon:ne}),null)};L.displayName="UploadOutlined";L.inheritAttrs=!1;const Y=L;function A(i,e="YYYY-MM-DD HH:mm:ss"){if(!i)return"";const n=new Date(i);if(isNaN(n.getTime()))return"";const d={YYYY:n.getFullYear(),MM:String(n.getMonth()+1).padStart(2,"0"),DD:String(n.getDate()).padStart(2,"0"),HH:String(n.getHours()).padStart(2,"0"),mm:String(n.getMinutes()).padStart(2,"0"),ss:String(n.getSeconds()).padStart(2,"0")};return e.replace(/YYYY|MM|DD|HH|mm|ss/g,u=>d[u])}const le={class:"tools-container layout-container"},ie={class:"tools-grid"},re={class:"tool-card"},se={style:{color:"red"}},de={class:"custom-footer"},ue={__name:"digitalHumans",setup(i){const e=q({loading:!1,fileList:[],videoFileList:[],loadingTools:!1,videoList:[],dialogVisible:!1,formData:{}}),n={audio:[{required:!0,message:"请上传音频文件",trigger:"change"}],video:[{required:!0,message:"请上传视频文件",trigger:"change"}],content:[{required:!0,message:"输出内容不能为空",trigger:"blur"}]},d=I(null),u=async()=>{e.loading=!0;const r=await G();e.videoList=r.data.data,e.loading=!1},P=()=>{e.dialogVisible=!0,e.formData={audio:null,video:null,content:""}},h=({fileList:r},t)=>{var s;e.formData[t]=((s=r[0])==null?void 0:s.originFileObj)||null},C=(r,t)=>{const s=e[`${t}FileList`],_=s.indexOf(r),f=s.slice();f.splice(_,1),e[`${t}FileList`]=f,e.formData[t]=null},j=async()=>{try{if(!e.formData.audio||!e.formData.video){D.error("音频或视频文件为空");return}if(e.formData.content===void 0||e.formData.content.trim()===""){D.error("输出内容不能为空");return}const r=new FormData;r.append("audio",e.formData.audio),r.append("video",e.formData.video),r.append("content",e.formData.content),e.loadingTools=!0;const t=await Z(r);t.data.code===0?(e.dialogVisible=!1,await u()):D.error("生成失败: "+(t.data.msg||"未知错误"))}catch(r){console.error("表单验证失败:",r)}finally{e.loadingTools=!1}},S=()=>{e.dialogVisible=!1,e.loadingTools=!1,e.formData={},e.fileList=[],e.videoFileList=[]},N=async r=>{try{const t=r.generate_video_url,s=t.substring(t.lastIndexOf("/")+1),_=await K(r.ID);if(console.log("handleDownload:",_),_.statusText==="OK"){const f=new Blob([_.data],{type:s.endsWith(".mp4")?"video/mp4":"audio/wav"}),b=window.URL.createObjectURL(f),g=document.createElement("a");g.href=b,g.setAttribute("download",s),document.body.appendChild(g),g.click(),g.parentNode.removeChild(g),window.URL.revokeObjectURL(b)}}catch(t){console.error("下载失败:",t),D.error("下载失败，请稍后再试")}};return Q(()=>{u()}),(r,t)=>{const s=m("a-button"),_=m("a-space"),f=m("a-table-column"),b=m("a-progress"),g=m("a-table"),F=m("a-divider"),k=m("a-upload"),y=m("a-form-item"),T=m("a-textarea"),R=m("a-form"),$=m("a-modal");return U(),W("div",le,[a(z,{title:"数字人"},{description:o(()=>t[6]||(t[6]=[c("p",null,"使用指南",-1),c("ol",null,[c("li",null,"准备工作：准备好一个视频文件+一个音频文件，以支持数字人的运行。"),c("li",null,"步骤1：点击“新增”，选择音频文件（.wav格式）和视频文件（.mp4格式）。"),c("li",null,"步骤2：输入数字人的对话内容，并点击“确认”。"),c("li",null,"步骤3：点击“确认”，等待数字人生成视频。"),c("li",null,"步骤4：等待视频生成完成。"),c("li",null,"步骤5：点击“下载”按钮，下载生成的视频文件。"),c("li",null,"步骤6：点击“刷新”按钮，查看已生成的视频列表。")],-1)])),actions:o(()=>t[7]||(t[7]=[])),_:1}),c("div",ie,[a(_,{size:8,align:"start"},{default:o(()=>[a(s,{class:"editable-add-btn",style:{width:"60px"},onClick:P},{default:o(()=>t[8]||(t[8]=[p(" 新增")])),_:1}),a(s,{class:"editable-add-btn",style:{width:"60px"},type:"primary",onClick:u},{default:o(()=>t[9]||(t[9]=[p(" 刷新 ")])),_:1})]),_:1}),c("div",re,[a(g,{"data-source":e.videoList,loading:e.loading,pagination:!1,scroll:{x:"100%",y:500},bordered:"",size:"small"},{default:o(()=>[a(f,{key:"audio_name",align:"center","data-index":"audio_name",title:"音频名称","min-width":"120"}),a(f,{key:"video_name",align:"center","data-index":"video_name",title:"视频名称","min-width":"120"}),a(f,{key:"progress",align:"center","data-index":"progress",title:"进度","min-width":"120"},{default:o(({record:l})=>[a(b,{percent:l.progress,size:"small","stroke-linecap":"square",style:{width:"96%"}},{format:o(w=>[c("span",se,O(w)+"% ",1)]),_:2},1032,["percent"])]),_:1}),a(f,{key:"msg",align:"center","data-index":"msg",title:"Msg","min-width":"200"}),a(f,{key:"CreatedAt",align:"center","data-index":"CreatedAt",title:"创建时间","min-width":"160"},{default:o(({record:l})=>[p(O(v(A)(l.CreatedAt||"")),1)]),_:1}),a(f,{key:"UpdatedAt",align:"center","data-index":"UpdatedAt",title:"更新时间","min-width":"160"},{default:o(({record:l})=>[p(O(v(A)(l.UpdatedAt||"")),1)]),_:1}),a(f,{key:"action",align:"center",fixed:"right",title:"操作",width:"100"},{default:o(({record:l})=>{var w;return[(w=l.generate_video_url)!=null&&w.trim()?(U(),J(s,{key:0,size:"small",onClick:ce=>N(l)},{icon:o(()=>[a(v(te))]),default:o(()=>[t[10]||(t[10]=p(" 下载 "))]),_:2},1032,["onClick"])):X("",!0)]}),_:1})]),_:1},8,["data-source","loading"]),a($,{ref_key:"formRef",ref:d,visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=l=>e.dialogVisible=l),afterClose:S,centered:"",title:"新增"},{footer:o(()=>[c("div",de,[a(s,{loading:e.loadingTools,type:"primary",onClick:j},{default:o(()=>t[14]||(t[14]=[p("确 认 ")])),_:1},8,["loading"]),a(s,{onClick:S},{default:o(()=>t[15]||(t[15]=[p("取 消")])),_:1})])]),default:o(()=>[a(F),a(R,{model:e.formData,rules:n},{default:o(()=>[a(y,{label:"音频文件",name:"audio"},{default:o(()=>[a(k,{"file-list":e.fileList,"onUpdate:fileList":t[0]||(t[0]=l=>e.fileList=l),"before-upload":()=>!1,"max-count":1,multiple:!1,remove:l=>C(l,"audio"),accept:".wav",name:"file",onChange:t[1]||(t[1]=l=>h(l,"audio"))},{default:o(()=>[a(s,null,{default:o(()=>[a(v(Y)),t[11]||(t[11]=p(" 音频（作为数字人声音） "))]),_:1})]),_:1},8,["file-list","remove"])]),_:1}),a(y,{label:"视频文件",name:"video"},{default:o(()=>[a(k,{"file-list":e.videoFileList,"onUpdate:fileList":t[2]||(t[2]=l=>e.videoFileList=l),"before-upload":()=>!1,"max-count":1,multiple:!1,remove:l=>C(l,"video"),"size-limit":1024*1024*100,accept:".mp4",name:"file",onChange:t[3]||(t[3]=l=>h(l,"video"))},{default:o(()=>[a(s,null,{default:o(()=>[a(v(Y)),t[12]||(t[12]=p(" 视频（作为数字人形象） "))]),_:1})]),_:1},8,["file-list","remove"])]),_:1}),a(y,{label:"输出内容",name:"content"},{default:o(()=>[a(T,{value:e.formData.content,"onUpdate:value":t[4]||(t[4]=l=>e.formData.content=l),rows:4,"allow-clear":""},null,8,["value"]),t[13]||(t[13]=p(" （作为数字人所讲话述） "))]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])])}}},pe=E(ue,[["__scopeId","data-v-4c840a78"]]);export{pe as default};
